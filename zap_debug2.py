import requests
import time

api_key = 'yourapikey'
zap_base_url = 'http://localhost:8090'

def start_spider(url):
    spider_url = f"{zap_base_url}/JSON/spider/action/scan/?apikey={api_key}&url={url}&recurse=true"
    response = requests.get(spider_url)
    scan_id = response.json().get('scan')
    return scan_id

def check_spider_status(scan_id):
    status_url = f"{zap_base_url}/JSON/spider/view/status/?apikey={api_key}&scanId={scan_id}"
    while True:
        response = requests.get(status_url)
        status = response.json().get('status')
        print(f'Spider status: {status}%')
        if status == '100':
            break
        time.sleep(5)

def start_scan(url):
    scan_url = f"{zap_base_url}/JSON/ascan/action/scan/?apikey={api_key}&url={url}&recurse=true"
    response = requests.get(scan_url)
    scan_id = response.json().get('scan')
    return scan_id

def check_scan_status(scan_id):
    status_url = f"{zap_base_url}/JSON/ascan/view/status/?apikey={api_key}&scanId={scan_id}"
    while True:
        response = requests.get(status_url)
        status = response.json().get('status')
        print(f'Scan status: {status}%')
        if status == '100':
            break
        time.sleep(5)

def generate_report():
    report_url = f"{zap_base_url}/OTHER/core/other/htmlreport/?apikey={api_key}"
    response = requests.get(report_url)
    with open('zap_report.html', 'wb') as f:
        f.write(response.content)
    print("Report saved as zap_report.html")

if __name__ == "__main__":
    target_url = "http://localhost:3000/#/"
    
    print("Starting Spider...")
    spider_id = start_spider(target_url)
    check_spider_status(spider_id)
    
    print("Starting Active Scan...")
    scan_id = start_scan(target_url)
    check_scan_status(scan_id)
    
    print("Generating Report...")
    generate_report()
